#!/usr/bin/env perl

use strict;
use warnings;

use FindBin;
use Catlady;
use AnyEvent::Debug;

#open STDERR, ">>", "/home/leedo/logs/catlady_errors.log";
#open STDOUT, ">>", "/home/leedo/logs/catlady.log";

if (-e "$FindBin::Bin/../var/shell.sock") {
  die "debug socket exists!";
}

use JSON::XS;

my $config = do {
  local $/;
  open my $fh, '<', $ARGV[0] or die "need config file";
  decode_json <$fh>;
};

our $SHELL = AnyEvent::Debug::shell "unix/", "$FindBin::Bin/../var/shell.sock";
our $catlady = Catlady->new(%$config);
$catlady->run;
